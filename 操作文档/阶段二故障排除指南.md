# 阶段二故障排除指南

## 🔍 问题诊断流程

### 第一步：确定问题类型
1. **功能性问题**：功能无法正常工作
2. **性能问题**：运行缓慢或卡顿
3. **界面问题**：UI显示异常
4. **数据问题**：结果不准确或异常

### 第二步：收集问题信息
- 操作系统和版本
- 软件版本信息
- 点云数据规模和格式
- 具体操作步骤
- 错误信息截图
- 日志文件内容

## 🚨 常见问题及解决方案

### 1. 线段绘制问题

#### 问题1.1：无法绘制线段
**症状**：点击鼠标无反应，无法创建线段

**可能原因**：
- 未正确进入线段绘制模式
- 鼠标点击位置超出有效区域
- 视图状态异常

**解决方案**：
```
1. 检查菜单状态：确认"基于线段的墙面拟合"已激活
2. 重置视图：按F键重置俯视图到合适位置
3. 检查点云加载：确认点云数据已正确加载
4. 重启绘制模式：按Esc退出当前模式，重新激活
```

**验证方法**：
- 状态栏显示"线段绘制模式"
- 鼠标悬停时显示十字光标
- 点击时有视觉反馈

#### 问题1.2：线段显示异常
**症状**：线段颜色错误、粗细异常或闪烁

**可能原因**：
- OpenGL渲染状态错误
- 显卡驱动问题
- 视图缩放级别不当

**解决方案**：
```
1. 更新显卡驱动到最新版本
2. 调整视图缩放：使用鼠标滚轮调整到合适级别
3. 重置渲染设置：重启软件恢复默认设置
4. 检查硬件加速：确认OpenGL硬件加速已启用
```

#### 问题1.3：线段选择困难
**症状**：难以选中线段或选择不准确

**可能原因**：
- 选择容差设置过小
- 线段重叠或过于密集
- 鼠标精度问题

**解决方案**：
```
1. 调整选择容差：在设置中增大选择容差值
2. 放大视图：使用鼠标滚轮放大到合适级别
3. 使用框选：拖拽鼠标进行框选操作
4. 清理重叠线段：删除不必要的重叠线段
```

### 2. 墙面拟合问题

#### 问题2.1：拟合结果不准确
**症状**：检测到的墙面位置错误或数量不对

**可能原因**：
- 算法参数不适合当前数据
- 点云数据质量问题
- 用户线段绘制不准确

**解决方案**：
```
1. 调整RANSAC参数：
   - 降低距离阈值：0.1 → 0.05（高精度）
   - 增加最小内点数：50 → 100（减少噪声）
   - 增加迭代次数：1000 → 2000（提高准确性）

2. 检查点云质量：
   - 确认点云密度足够（>1000点/m²）
   - 检查是否有明显噪声或异常点
   - 验证坐标系统是否正确

3. 改进线段绘制：
   - 确保线段沿着墙面方向绘制
   - 覆盖主要墙面区域
   - 避免绘制在门窗等开口处
```

#### 问题2.2：处理速度过慢
**症状**：墙面拟合过程耗时过长

**可能原因**：
- 点云数据量过大
- 算法参数设置不当
- 系统资源不足

**解决方案**：
```
1. 优化数据量：
   - 使用LOD功能降低点云密度
   - 裁剪不必要的区域
   - 分块处理大型数据

2. 调整算法参数：
   - 减少最大迭代次数：1000 → 500
   - 增大距离阈值：0.1 → 0.15
   - 降低最小内点数：50 → 30

3. 系统优化：
   - 关闭其他占用资源的程序
   - 增加系统内存
   - 使用SSD存储提高I/O速度
```

#### 问题2.3：拟合过程中断
**症状**：处理过程意外停止或崩溃

**可能原因**：
- 内存不足
- 数据格式错误
- 算法异常

**解决方案**：
```
1. 检查系统资源：
   - 确保有足够的可用内存（建议>4GB）
   - 监控CPU使用率
   - 检查磁盘空间

2. 验证数据完整性：
   - 重新加载点云数据
   - 检查数据格式是否正确
   - 验证坐标范围是否合理

3. 启用调试模式：
   - 查看详细错误日志
   - 使用较小的测试数据集
   - 逐步增加数据规模
```

### 3. 界面和交互问题

#### 问题3.1：进度对话框无响应
**症状**：进度对话框卡住不更新

**可能原因**：
- UI线程阻塞
- 进度回调函数异常
- 系统资源不足

**解决方案**：
```
1. 等待处理完成：某些情况下需要较长时间
2. 检查系统响应：按Ctrl+Alt+Del查看任务管理器
3. 强制取消操作：按Esc键或点击取消按钮
4. 重启软件：如果完全无响应，重启软件
```

#### 问题3.2：结果对话框显示异常
**症状**：结果数据显示错误或格式异常

**可能原因**：
- 数据格式转换错误
- 界面组件初始化失败
- 字符编码问题

**解决方案**：
```
1. 刷新显示：关闭对话框重新打开
2. 检查数据完整性：验证原始结果数据
3. 重新执行拟合：清除缓存重新处理
4. 导出原始数据：使用JSON格式导出验证
```

### 4. 数据导入导出问题

#### 问题4.1：无法保存线段数据
**症状**：保存操作失败或文件损坏

**可能原因**：
- 文件路径权限不足
- 磁盘空间不够
- 文件被其他程序占用

**解决方案**：
```
1. 检查文件权限：
   - 选择有写权限的目录
   - 以管理员身份运行软件
   - 检查文件是否被占用

2. 验证存储空间：
   - 确保磁盘有足够空间
   - 清理临时文件
   - 选择其他存储位置

3. 更换文件格式：
   - 尝试不同的导出格式
   - 使用较短的文件名
   - 避免特殊字符
```

#### 问题4.2：加载数据失败
**症状**：无法读取之前保存的文件

**可能原因**：
- 文件格式版本不兼容
- 文件内容损坏
- 路径包含特殊字符

**解决方案**：
```
1. 验证文件完整性：
   - 检查文件大小是否正常
   - 用文本编辑器查看JSON格式
   - 验证文件编码格式

2. 版本兼容性：
   - 确认文件版本与软件版本兼容
   - 尝试使用较早版本的软件打开
   - 手动修复JSON格式错误

3. 路径问题：
   - 使用英文路径和文件名
   - 避免空格和特殊字符
   - 复制文件到简单路径
```

## 🔧 高级故障排除

### 性能分析工具

#### 内存使用监控
```cpp
// 监控内存使用情况
void monitorMemoryUsage() {
    PROCESS_MEMORY_COUNTERS pmc;
    GetProcessMemoryInfo(GetCurrentProcess(), &pmc, sizeof(pmc));
    
    qDebug() << "Working Set:" << pmc.WorkingSetSize / 1024 / 1024 << "MB";
    qDebug() << "Peak Working Set:" << pmc.PeakWorkingSetSize / 1024 / 1024 << "MB";
}
```

#### 性能计时器
```cpp
// 测量操作执行时间
class PerformanceTimer {
    std::chrono::high_resolution_clock::time_point start;
public:
    void start() { start = std::chrono::high_resolution_clock::now(); }
    double elapsed() {
        auto end = std::chrono::high_resolution_clock::now();
        return std::chrono::duration<double>(end - start).count();
    }
};
```

### 日志分析

#### 关键日志信息
```
[INFO] Point cloud loaded: 125000 points
[DEBUG] RANSAC iteration 500/1000, best inliers: 1250
[WARNING] Low confidence plane detected: 0.65
[ERROR] Insufficient memory for processing
[CRITICAL] Algorithm convergence failed
```

#### 日志级别说明
- **DEBUG**：详细的调试信息，用于开发调试
- **INFO**：一般信息，记录正常操作流程
- **WARNING**：警告信息，可能影响结果质量
- **ERROR**：错误信息，操作失败但程序可继续
- **CRITICAL**：严重错误，程序可能崩溃

### 系统要求检查

#### 最低系统要求
- **操作系统**：Windows 10 64位 / Linux Ubuntu 18.04+
- **内存**：8GB RAM（推荐16GB）
- **显卡**：支持OpenGL 3.3的独立显卡
- **存储**：1GB可用空间
- **CPU**：Intel i5或AMD同等级别处理器

#### 推荐系统配置
- **内存**：32GB RAM
- **显卡**：NVIDIA GTX 1060或更高
- **存储**：SSD固态硬盘
- **CPU**：Intel i7或AMD Ryzen 7

## 📞 获取技术支持

### 问题报告模板
```
【问题描述】
简要描述遇到的问题

【系统信息】
- 操作系统：Windows 10 Pro 64位
- 软件版本：v2.0.0
- 硬件配置：Intel i7-8700K, 16GB RAM, GTX 1070

【数据信息】
- 点云格式：PCD
- 点云大小：125,000点
- 数据范围：10m x 8m x 3m

【操作步骤】
1. 加载点云数据
2. 绘制墙面轮廓线段
3. 执行基于线段的墙面拟合
4. 出现错误

【错误信息】
粘贴具体的错误信息或截图

【期望结果】
描述期望的正确结果

【实际结果】
描述实际发生的情况
```

### 联系方式
- **技术支持邮箱**：support@wallextraction.com
- **用户论坛**：https://forum.wallextraction.com
- **在线文档**：https://docs.wallextraction.com
- **GitHub Issues**：https://github.com/wallextraction/issues

### 远程协助
对于复杂问题，我们提供远程协助服务：
1. 预约远程协助时间
2. 安装远程协助软件
3. 技术人员远程诊断问题
4. 提供解决方案和优化建议

---

**如果以上解决方案无法解决您的问题，请联系技术支持团队获取进一步帮助。我们致力于为您提供最佳的技术支持服务。**
